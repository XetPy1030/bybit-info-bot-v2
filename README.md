# Telegram-бот для мониторинга баланса на Bybit

## Описание

Этот проект представляет собой Telegram-бота, который отслеживает баланс криптовалютного аккаунта на платформе Bybit и предоставляет пользователю информацию о балансе в реальном времени, а также строит графики изменения баланса за последние 30 дней и текущий день. Бот поддерживает получение данных как через API Bybit, так и с использованием cookies, обеспечивая гибкость в настройках.

### Основные функции:

1. **Подключение к Bybit API и использование cookies:**
   - Бот может получать информацию о балансе через API Bybit или с использованием cookies, в зависимости от настроек.
   - В случае невозможности подключения к API, бот автоматически переключается на использование cookies.

2. **Получение и отображение баланса:**
   - Получение информации о балансе в USDT и RUB.
   - Преобразование баланса из USDT в RUB на основе текущего курса с использованием API CoinGecko.
   - Хранение истории балансов в Excel-файле (`balance_data.xlsx`), включая данные об изменении баланса за последние 24 часа.

3. **Генерация графиков:**
   - **График баланса за текущий день:** отображает баланс USDT на протяжении дня.
   - **Средний баланс за последние 30 дней:** показывает средний баланс за последний месяц.

4. **Регулярное обновление данных:**
   - Каждые 30 минут бот обновляет базу данных с балансом и отправляет актуальную информацию в Telegram.
   - В случае ошибки соединения или истечения срока действия cookies, бот отправляет уведомления администраторам.

5. **Административная панель:**
   - Управление настройками бота через панель администратора, доступную только для администраторов.
   - Возможность изменять токен бота, API-ключи, cookies, интервалы обновления данных и отправки баланса.
   - Добавление и удаление администраторов.
   - Скачивание базы данных и просмотр текущих настроек.
   - Перезапуск бота и управление режимом ожидания.

6. **Интерфейс Telegram-бота:**
   - Команды для пользователей:
     - `/start` и `/help`: запуск бота и получение базовой информации.
     - `/balance`: отправка текущего баланса аккаунта.
     - `/graph`: отправка графиков изменения баланса.
     - `/admin`: доступ к административной панели (только для администраторов).

### Важные настройки

Все конфигурационные параметры хранятся в файле `config.json`, включая токен бота, ключи API, cookies, администраторов и интервалы обновления данных.


### Установка

1. **Клонирование репозитория:**
   ```bash
   git clone https://github.com/yourusername/your-repo.git
   cd your-repo
   ```

2. **Установка зависимостей:**
   ```bash
   pip install requests pyTelegramBotAPI matplotlib openpyxl
   ```

3. **Настройка конфигурации:**
   - Создайте файл `config.json` и заполните его своими данными согласно необходимым параметрам.

4. **Запуск:**
   Для запуска бота выполните:
   ```bash
   python bot.py
   ```

### Административные команды

- `/admin`: Открывает панель администратора для изменения настроек.
- В панели администратора доступны кнопки для изменения конфигурации, скачивания базы данных, управления администраторами и другие функции.

### Управление потоками

Бот использует два отдельных потока для выполнения регулярных задач:

1. **Обновление базы данных (`db_update_loop`):**
   - Каждые `db_update_interval` минут обновляет баланс в базе данных.

2. **Отправка баланса (`balance_send_loop`):**
   - Каждые `balance_send_interval` минут отправляет актуальную информацию о балансе в Telegram.

### Административная панель

Панель администратора позволяет управлять настройками бота через интерактивные кнопки. Администратор может:

- Изменять токен бота, API-ключи, секретные ключи и cookies.
- Переключать режим использования API (`USE_API`).
- Скачивать базу данных в формате Excel.
- Изменять интервалы обновления базы данных и отправки баланса.
- Добавлять и удалять администраторов.
- Просматривать текущие настройки.
- Перезапускать бота и снимать режим ожидания.

Перезапускать бота и снимать режим ожидания.

![Результат](image.png)
